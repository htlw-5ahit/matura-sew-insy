# 9.2.-3. MongoDB

### Grundaufbau MongoDB

<img src="./MongoDB_Datenbankstruktur.png" width="600">

Quelle: [MongoDB_1 (S. 6)](../archiv/insy-game/jahrgang5/MongoDB_1.pdf)

### Vergleich MongoDB und RDBMS

| RDBMS       | MongoDB               |
|-------------|-----------------------|
| Database    | Database              |
| Table, View | Collection            |
| Row         | Document (JSON, BSON) |
| Column      | Field                 |
| Index       | Index                 |
| Join        | Embedded Document     |
| Foreign Key | Reference             |
| Partition   | Shard                 |


Quelle: [MongoDB_1 (S. 7)](../archiv/insy-game/jahrgang5/MongoDB_1.pdf)

### Was ändert sich bei der Modellierung?

### Was sind Aggregate im Zusammenhang mit der Modellierung?

* Aggregate statt Relationen
* Key-Value-Stores und Dokumentendatenbanken sind „Aggregatorientiert“.
* Aggregat: „collection of related objects that we wish to treat as a unit“
* Aggregate vereinfachen die Verteilung der Daten: Replikation, Sharding

<img src="./Aggregate_Beispiel.png" width="500">

* Ich lege eine Strukturierung der Daten als Aggregate fest.
    * Bestellungen (orders) werden als Aggregate gespeichert.
    * Bestellungen sind leicht suchbar.

| Diagramm | Umsetzung: Post | Umsetzung: User |
|---|---|---|
| ![](./Aggregate_Beispiel2.png) | ![](./Aggregate_Beispiel2_Umsetzung1.png) | ![](./Aggregate_Beispiel2_Umsetzung2.png) |

Quelle: [MongoDB_2 (S. 4-6)](../archiv/insy-game/jahrgang5/MongoDB_2.pdf)

### Wie funktioniert die Umsetzung von Beziehungen?

| Beziehung | Darstellung | Umsetzung |
|---|---|---|
| 1:1 | ![](./MongoDB_Beziehung_1_1.png) | // von a nach b:<br>`var a = db.a.find(..)`<br>`var b = db.b.find({_id:a.b_id})`<br>// von b nach a<br>`var b = db.b.find(..)`<br>`var a = db.a.find({b_id:b._id})` |
| 1:n (Variante 1) | ![](./MongoDB_Beziehung_1_n_Variante1.png) | // bestellungen zum kunden<br>`var kunde = db.kunden.find(…)`<br>`var bestellungen = db.bestellungen.find({_id: {$in: kunde.bestellungen}})`<br>// kunde zur bestellung<br>`var bestellung = db.bestellungen.find(…)`<br>`var kunde = db.kunden.find({bestellungen: bestellung._id})` |
| 1:n (Variante 2) | ![](./MongoDB_Beziehung_1_n_Variante2.png) | // bestellungen zum kunden<br>`var kunde = db.kunden.find(…)`<br>`var bestellungen = db.bestellungen.find({kunden_id: kunde._id}} )`<br>// kunde zur bestellung<br>`var bestellung = db.bestellungen.find(…)`<br>`var kunde = db.kunden.find({_id: bestellungen: kunden._id})` |
| n:m | ![](./MongoDB_Beziehung_n_m.png) |  |

Quelle: [MongoDB_2 (S. 12-18)](../archiv/insy-game/jahrgang5/MongoDB_2.pdf)

### Was ist Replication?

### Wie läuft sie ab?

### Was ist Sharding?

### Wie erfolgt die Auswahl eines Sharding Keys?